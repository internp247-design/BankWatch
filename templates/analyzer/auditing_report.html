{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="bankwatch-audit-report">
    <!-- Audit Report Header with Breadcrumb -->
    <div class="audit-header">
        <div class="container-fluid">
            <div class="header-breadcrumb">
                <a href="{% url 'dashboard' %}" class="breadcrumb-link">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <i class="fas fa-chevron-right"></i>
                <span class="breadcrumb-current">Forensic Audit Report</span>
            </div>
            
            <div class="header-content">
                <div class="header-left">
                    <h1>Forensic Audit Report</h1>
                    <div class="account-info">
                        <i class="fas fa-building-columns"></i>
                        <span>{{ account.account_name }}</span>
                        <span class="separator">•</span>
                        <span>{{ account.bank_name }}</span>
                    </div>
                </div>
                
                <div class="header-right">
                    {% if accounts.count > 1 %}
                    <div class="account-switcher">
                        <button class="btn-switch-account" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-exchange-alt"></i>
                            <span>Switch Account</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            {% for acc in accounts %}
                            <li>
                                <a href="{% url 'audit_report_account' acc.id %}" 
                                   class="dropdown-item {% if acc.id == account.id %}active{% endif %}">
                                    <div class="account-option">
                                        <div class="account-icon">
                                            <i class="fas fa-university"></i>
                                        </div>
                                        <div class="account-details">
                                            <div class="account-name">{{ acc.account_name }}</div>
                                            <small class="account-bank">{{ acc.bank_name }}</small>
                                        </div>
                                        {% if acc.id == account.id %}
                                        <i class="fas fa-check text-primary"></i>
                                        {% endif %}
                                    </div>
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <div class="action-buttons">
                        <button class="btn-audit-action export-btn" title="Export as PDF">
                            <i class="fas fa-file-export"></i>
                            <span>Export</span>
                        </button>
                        <button class="btn-audit-action print-btn" title="Print Report">
                            <i class="fas fa-print"></i>
                            <span>Print</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="audit-container">
        {% if no_data %}
        <div class="no-data-section">
            <div class="empty-state-card">
                <div class="empty-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h3>No Audit Data Available</h3>
                <p>Upload bank statements to generate forensic audit report</p>
                <a href="{% url 'upload_statement' %}" class="btn-primary">
                    <i class="fas fa-upload"></i>
                    Upload Statements
                </a>
            </div>
        </div>
        {% else %}

        <!-- Audit Summary Cards -->
        <div class="audit-summary-section">
            <div class="summary-info-bar">
                <div class="info-section">
                    <span class="section-label">Quick Links:</span>
                    <div class="quick-links">
                        <a href="{% url 'upload_statement' %}" class="quick-link" title="Upload new statement">
                            <i class="fas fa-upload"></i>
                            <span>Upload</span>
                        </a>
                        <a href="{% url 'rules_application_results' %}" class="quick-link" title="View all transactions">
                            <i class="fas fa-list"></i>
                            <span>Transactions</span>
                        </a>
                        <a href="{% url 'dashboard' %}" class="quick-link" title="View all accounts">
                            <i class="fas fa-university"></i>
                            <span>Accounts</span>
                        </a>
                        <a href="{% url 'rules_list' %}" class="quick-link" title="View rules">
                            <i class="fas fa-sliders-h"></i>
                            <span>Rules</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="summary-cards-grid">
                <!-- Data Integrity Card -->
                <div class="summary-card integrity-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Data Integrity</h3>
                        <div class="card-score {% if data_integrity.quality_score >= 80 %}score-high{% elif data_integrity.quality_score >= 60 %}score-medium{% else %}score-low{% endif %}">
                            {{ data_integrity.quality_score }}%
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-label">Total Transactions</div>
                                <div class="metric-value">{{ data_integrity.total_transactions }}</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Date Range</div>
                                <div class="metric-value">{{ data_integrity.date_range_days }} days</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Statements</div>
                                <div class="metric-value">{{ data_integrity.statements_count }}</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Duplicates</div>
                                <div class="metric-value">{{ data_integrity.duplicate_count }}</div>
                            </div>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ data_integrity.quality_score }}%"></div>
                            </div>
                            <div class="progress-labels">
                                <span>Quality Score</span>
                                <span>{{ data_integrity.quality_score }}%</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="status-tag {% if data_integrity.validation_status == 'Pass' %}status-success{% elif data_integrity.validation_status == 'Warning' %}status-warning{% else %}status-danger{% endif %}">
                            {{ data_integrity.validation_status }}
                        </div>
                        <div class="date-range">
                            {{ data_integrity.earliest_date|date:"M d" }} - {{ data_integrity.latest_date|date:"M d, Y" }}
                        </div>
                    </div>
                </div>

                <!-- Financial Overview Card -->
                <div class="summary-card financial-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <h3>Financial Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="financial-metrics">
                            <div class="financial-item income">
                                <div class="financial-label">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>Total Income</span>
                                </div>
                                <div class="financial-amount">₹{{ financial_summary.total_credits|floatformat:2 }}</div>
                                <div class="financial-percentage">
                                    {% widthratio financial_summary.total_credits financial_summary.total_credits|add:financial_summary.total_debits 100 %}%
                                </div>
                            </div>
                            
                            <div class="financial-item expense">
                                <div class="financial-label">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>Total Expense</span>
                                </div>
                                <div class="financial-amount">₹{{ financial_summary.total_debits|floatformat:2 }}</div>
                                <div class="financial-percentage">
                                    {% widthratio financial_summary.total_debits financial_summary.total_credits|add:financial_summary.total_debits 100 %}%
                                </div>
                            </div>
                            
                            <div class="financial-flow">
                                <div class="flow-bar">
                                    <div class="income-flow" style="width: {% widthratio financial_summary.total_credits financial_summary.total_credits|add:financial_summary.total_debits 100 %}%"></div>
                                    <div class="expense-flow" style="width: {% widthratio financial_summary.total_debits financial_summary.total_credits|add:financial_summary.total_debits 100 %}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="net-balance">
                            <div class="net-label">Net Balance Change</div>
                            <div class="net-amount {% if financial_summary.net_change >= 0 %}positive{% else %}negative{% endif %}">
                                ₹{{ financial_summary.net_change|floatformat:2 }}
                            </div>
                            <div class="savings-info">
                                <i class="fas fa-percentage"></i>
                                <span>Savings Rate: {{ financial_summary.savings_rate }}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Risk Overview Card -->
                <div class="summary-card risk-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3>Risk Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="risk-metrics">
                            <div class="risk-item high-risk">
                                <div class="risk-count">{{ monthly_risks|length }}</div>
                                <div class="risk-label">Analysis Periods</div>
                            </div>
                            <div class="risk-item medium-risk">
                                <div class="risk-count">{{ counterparties|length }}</div>
                                <div class="risk-label">Counterparties</div>
                            </div>
                            <div class="risk-item transactions">
                                <div class="risk-count">{{ high_value_transactions|length }}</div>
                                <div class="risk-label">High Value Txns</div>
                            </div>
                        </div>
                        
                        <div class="risk-distribution">
                            <div class="distribution-item">
                                <div class="distribution-label">Overall Risk Level</div>
                                <div class="distribution-value">
                                    <span class="risk-tag high-risk">
                                        High
                                    </span>
                                </div>
                            </div>
                            <div class="distribution-item">
                                <div class="distribution-label">Analysis Period</div>
                                <div class="distribution-value">{{ monthly_risks|length }} months</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Analysis Sections -->
        <div class="detailed-analysis">
            <!-- Navigation Tabs -->
            <div class="analysis-tabs">
                <nav>
                    <div class="nav nav-tabs" id="auditTabs" role="tablist">
                        <button class="nav-link active" id="transaction-tab" data-bs-toggle="tab" data-bs-target="#transaction-panel" type="button">
                            <i class="fas fa-exchange-alt"></i>
                            Transaction Channels
                        </button>
                        <button class="nav-link" id="monthly-tab" data-bs-toggle="tab" data-bs-target="#monthly-panel" type="button">
                            <i class="fas fa-calendar-alt"></i>
                            Monthly Analysis
                        </button>
                        <button class="nav-link" id="highvalue-tab" data-bs-toggle="tab" data-bs-target="#highvalue-panel" type="button">
                            <i class="fas fa-gem"></i>
                            High Value Transactions
                        </button>
                        <button class="nav-link" id="counterparty-tab" data-bs-toggle="tab" data-bs-target="#counterparty-panel" type="button">
                            <i class="fas fa-network-wired"></i>
                            Counterparty Network
                        </button>
                    </div>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="tab-content" id="auditTabContent">
                <!-- Transaction Channels Panel -->
                <div class="tab-pane fade show active" id="transaction-panel" role="tabpanel">
                    <div class="panel-header">
                        <h3>Transaction Channel Analysis</h3>
                        <p>Breakdown of transactions by payment channels and risk assessment</p>
                    </div>
                    <div class="panel-content">
                        <div class="channel-analysis">
                            {% for channel, stats in transaction_mix.items %}
                            <div class="channel-card" data-risk="{{ stats.risk_level }}">
                                <div class="channel-header">
                                    <div class="channel-title">
                                        <div class="channel-icon">
                                            {% if channel == 'UPI' %}
                                            <i class="fas fa-mobile-alt"></i>
                                            {% elif channel == 'NEFT' %}
                                            <i class="fas fa-bank"></i>
                                            {% elif channel == 'CASH' %}
                                            <i class="fas fa-money-bill-wave"></i>
                                            {% else %}
                                            <i class="fas fa-exchange-alt"></i>
                                            {% endif %}
                                        </div>
                                        <span>{{ channel }}</span>
                                    </div>
                                    <div class="channel-risk">
                                        <span class="risk-indicator {{ stats.risk_level|lower }}">{{ stats.risk_level }}</span>
                                    </div>
                                </div>
                                <div class="channel-stats">
                                    <div class="stat-row">
                                        <span class="stat-label">Transactions</span>
                                        <span class="stat-value">{{ stats.count }}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Percentage</span>
                                        <span class="stat-value">{{ stats.percentage }}%</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Total Amount</span>
                                        <span class="stat-value amount">₹{{ stats.amount|floatformat:0 }}</span>
                                    </div>
                                </div>
                                <div class="channel-progress">
                                    <div class="progress">
                                        <div class="progress-bar" style="width: {{ stats.percentage }}%"></div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Monthly Analysis Panel -->
                <div class="tab-pane fade" id="monthly-panel" role="tabpanel">
                    <div class="panel-header">
                        <h3>Monthly Risk Analysis</h3>
                        <p>Monthly breakdown of credits, debits, and risk flags</p>
                    </div>
                    <div class="panel-content">
                        <div class="monthly-analysis">
                            <div class="monthly-table-container">
                                <table class="monthly-table">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th class="text-end">Credits</th>
                                            <th class="text-end">Debits</th>
                                            <th class="text-end">Net Flow</th>
                                            <th>Risk Level</th>
                                            <th>Observations</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for month in monthly_risks %}
                                        <tr class="risk-{{ month.risk_level|lower }}">
                                            <td>
                                                <strong>{{ month.month }}</strong>
                                            </td>
                                            <td class="text-end">
                                                <span class="amount income">₹{{ month.credits|floatformat:0 }}</span>
                                            </td>
                                            <td class="text-end">
                                                <span class="amount expense">₹{{ month.debits|floatformat:0 }}</span>
                                            </td>
                                            <td class="text-end">
                                                <span class="amount {% if month.net_flow >= 0 %}income{% else %}expense{% endif %}">
                                                    ₹{{ month.net_flow|floatformat:0 }}
                                                </span>
                                            </td>
                                            <td>
                                                <span class="risk-badge {{ month.risk_level|lower }}">{{ month.risk_level }}</span>
                                            </td>
                                            <td>
                                                {% if month.risk_flags %}
                                                <div class="risk-flags">
                                                    {% for flag in month.risk_flags %}
                                                    <span class="flag-badge">{{ flag }}</span>
                                                    {% endfor %}
                                                </div>
                                                {% else %}
                                                <span class="text-muted">Normal</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- High Value Transactions Panel -->
                <div class="tab-pane fade" id="highvalue-panel" role="tabpanel">
                    <div class="panel-header">
                        <h3>High Value Transactions</h3>
                        <p>Large transactions requiring verification and follow-up</p>
                    </div>
                    <div class="panel-content">
                        {% if high_value_transactions %}
                        <div class="highvalue-table-container">
                            <table class="highvalue-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Category</th>
                                        <th class="text-end">Amount</th>
                                        <th>Type</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for trans in high_value_transactions %}
                                    <tr>
                                        <td>
                                            <div class="transaction-date">{{ trans.date|date:"M d, Y" }}</div>
                                        </td>
                                        <td>
                                            <div class="transaction-description">{{ trans.description|truncatewords:8 }}</div>
                                        </td>
                                        <td>
                                            <span class="category-tag">{{ trans.category_label }}</span>
                                        </td>
                                        <td class="text-end">
                                            <div class="transaction-amount {% if trans.type == 'CREDIT' %}credit{% else %}debit{% endif %}">
                                                {% if trans.type == 'DEBIT' %}-{% endif %}₹{{ trans.amount|floatformat:0 }}
                                            </div>
                                        </td>
                                        <td>
                                            <span class="type-badge {% if trans.type == 'CREDIT' %}credit-badge{% else %}debit-badge{% endif %}">
                                                {{ trans.type }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="action-tag">{{ trans.action }}</span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="empty-panel">
                            <div class="empty-content">
                                <i class="fas fa-search"></i>
                                <h4>No High Value Transactions</h4>
                                <p>No transactions were flagged as high value in this analysis period.</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Counterparty Network Panel -->
                <div class="tab-pane fade" id="counterparty-panel" role="tabpanel">
                    <div class="panel-header">
                        <h3>Counterparty Analysis</h3>
                        <p>Analysis of entities and institutions with frequent transactions</p>
                    </div>
                    <div class="panel-content">
                        {% if counterparties %}
                        <div class="counterparty-analysis">
                            <div class="counterparty-table-container">
                                <table class="counterparty-table">
                                    <thead>
                                        <tr>
                                            <th>Counterparty</th>
                                            <th class="text-center">Transactions</th>
                                            <th class="text-end">Credit %</th>
                                            <th class="text-end">Debit %</th>
                                            <th class="text-end">Total Amount</th>
                                            <th>Risk Level</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for cp in counterparties %}
                                        <tr class="risk-{{ cp.risk_level|lower }}">
                                            <td>
                                                <div class="counterparty-info">
                                                    <div class="counterparty-name">{{ cp.name|truncatewords:4 }}</div>
                                                    <div class="counterparty-meta">{{ cp.count }} transactions</div>
                                                </div>
                                            </td>
                                            <td class="text-center">
                                                <span class="transaction-count">{{ cp.count }}</span>
                                            </td>
                                            <td class="text-end">
                                                {% if cp.credit_concentration > 0 %}
                                                <span class="concentration credit">{{ cp.credit_concentration }}%</span>
                                                {% else %}
                                                <span class="concentration none">—</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                {% if cp.debit_concentration > 0 %}
                                                <span class="concentration debit">{{ cp.debit_concentration }}%</span>
                                                {% else %}
                                                <span class="concentration none">—</span>
                                                {% endif %}
                                            </td>
                                            <td class="text-end">
                                                <span class="total-amount">₹{{ cp.total_amount|floatformat:0 }}</span>
                                            </td>
                                            <td>
                                                <span class="risk-tag {{ cp.risk_level|lower }}">{{ cp.risk_level }}</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="concentration-summary">
                                <h4>Concentration Analysis</h4>
                                <div class="concentration-cards">
                                    {% for cp in counterparties|slice:":3" %}
                                    <div class="concentration-card">
                                        <div class="concentration-header">
                                            <span class="counterparty-name">{{ cp.name|truncatewords:2 }}</span>
                                            <span class="risk-indicator {{ cp.risk_level|lower }}">{{ cp.risk_level }}</span>
                                        </div>
                                        <div class="concentration-metrics">
                                            <div class="metric">
                                                <span class="label">Credit %</span>
                                                <span class="value credit">{{ cp.credit_concentration }}%</span>
                                            </div>
                                            <div class="metric">
                                                <span class="label">Debit %</span>
                                                <span class="value debit">{{ cp.debit_concentration }}%</span>
                                            </div>
                                            <div class="metric">
                                                <span class="label">Total</span>
                                                <span class="value">₹{{ cp.total_amount|floatformat:0 }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="empty-panel">
                            <div class="empty-content">
                                <i class="fas fa-user-friends"></i>
                                <h4>No Counterparty Data</h4>
                                <p>No counterparty analysis data available for this account.</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Footer -->
        <div class="report-footer">
            <div class="footer-content">
                <div class="report-info">
                    <div class="info-item">
                        <i class="fas fa-calendar"></i>
                        <span>Report Generated: {{ now|date:"F d, Y H:i" }}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-database"></i>
                        <span>{{ data_integrity.total_transactions }} transactions analyzed</span>
                    </div>
                </div>
                <div class="footer-actions">
                    <button class="btn-secondary">
                        <i class="fas fa-question-circle"></i>
                        <span>Help</span>
                    </button>
                    <button class="btn-secondary">
                        <i class="fas fa-comment-alt"></i>
                        <span>Provide Feedback</span>
                    </button>
                </div>
            </div>
        </div>

        {% endif %}
    </div>
</div>

<style>
    /* Base Styles */
    .bankwatch-audit-report {
        background-color: #f8fafc;
        min-height: 100vh;
        padding-bottom: 40px;
    }

    /* Audit Header */
    .audit-header {
        background: white;
        border-bottom: 1px solid #e2e8f0;
        padding: 16px 0;
        margin-bottom: 30px;
    }

    .header-breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
        font-size: 13px;
        color: #64748b;
    }

    .breadcrumb-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        color: #3b82f6;
        text-decoration: none;
        transition: color 0.2s;
    }

    .breadcrumb-link:hover {
        color: #2563eb;
    }

    .breadcrumb-link i {
        font-size: 12px;
    }

    .breadcrumb-current {
        color: #1e293b;
        font-weight: 600;
    }

    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 20px;
    }

    .header-left h1 {
        font-size: 24px;
        font-weight: 700;
        margin: 0 0 4px 0;
        color: #1e293b;
    }

    .account-info {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #64748b;
    }

    .account-info i {
        color: #0369a1;
    }

    .separator {
        opacity: 0.5;
    }

    .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    /* Account Switcher */
    .account-switcher {
        position: relative;
    }

    .btn-switch-account {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 14px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        color: #1e293b;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-switch-account:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }

    .account-switcher .dropdown-menu {
        min-width: 280px;
        padding: 8px;
        margin-top: 8px;
    }

    .account-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
    }

    .account-icon {
        width: 32px;
        height: 32px;
        background: #e0f2fe;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0369a1;
        flex-shrink: 0;
    }

    .account-details {
        flex: 1;
        min-width: 0;
    }

    .account-name {
        font-size: 13px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 2px;
    }

    .account-bank {
        color: #64748b;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 8px;
    }

    .btn-audit-action {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 14px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        color: #1e293b;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-audit-action:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }

    .export-btn {
        background: #e0f2fe;
        border-color: #bae6fd;
        color: #0369a1;
    }

    .export-btn:hover {
        background: #b3e5fc;
        border-color: #80deea;
    }

    .print-btn {
        background: #dcfce7;
        border-color: #bbf7d0;
        color: #166534;
    }

    .print-btn:hover {
        background: #bbf7d0;
        border-color: #86efac;
    }

    /* Main Container */
    .audit-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 30px 20px;
    }

    /* Summary Info Bar */
    .summary-info-bar {
        background: white;
        border-radius: 8px;
        padding: 16px 20px;
        margin-bottom: 24px;
        border: 1px solid #e2e8f0;
    }

    .info-section {
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .section-label {
        font-weight: 600;
        color: #1e293b;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .quick-links {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .quick-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: #f0f9ff;
        border: 1px solid #e0f2fe;
        border-radius: 6px;
        color: #0369a1;
        text-decoration: none;
        font-size: 12px;
        font-weight: 500;
        transition: all 0.2s;
    }

    .quick-link:hover {
        background: #e0f2fe;
        border-color: #bae6fd;
        transform: translateY(-1px);
    }

    .quick-link i {
        font-size: 12px;
    }

    /* Summary Cards */
    .audit-summary-section {
        margin-bottom: 30px;
    }

    .summary-cards-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    @media (max-width: 1024px) {
        .summary-cards-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 768px) {
        .summary-cards-grid {
            grid-template-columns: 1fr;
        }
    }

    .summary-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .summary-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .card-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .card-icon {
        width: 40px;
        height: 40px;
        background: #e0f2fe;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0369a1;
        font-size: 18px;
    }

    .card-header h3 {
        flex: 1;
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #1e293b;
    }

    .card-score {
        font-size: 18px;
        font-weight: 700;
        padding: 4px 12px;
        border-radius: 20px;
    }

    .score-high {
        background: #dcfce7;
        color: #166534;
    }

    .score-medium {
        background: #fef3c7;
        color: #92400e;
    }

    .score-low {
        background: #fee2e2;
        color: #991b1b;
    }

    .card-body {
        padding: 20px;
    }

    /* Integrity Card */
    .integrity-card .card-body {
        padding-bottom: 16px;
    }

    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 20px;
    }

    .metric-item {
        padding: 12px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .metric-label {
        font-size: 12px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .metric-value {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
    }

    .progress-container {
        margin-top: 20px;
    }

    .progress-bar {
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        border-radius: 4px;
    }

    .progress-labels {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #64748b;
    }

    .card-footer {
        padding: 16px 20px;
        background: #f8fafc;
        border-top: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .status-tag {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-success {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
    }

    .status-warning {
        background: #fef3c7;
        color: #92400e;
        border: 1px solid #fde68a;
    }

    .status-danger {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
    }

    .date-range {
        font-size: 12px;
        color: #64748b;
    }

    /* Financial Card */
    .financial-card .card-body {
        padding: 20px;
    }

    .financial-metrics {
        margin-bottom: 20px;
    }

    .financial-item {
        margin-bottom: 16px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .financial-label {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
        font-size: 13px;
        color: #64748b;
    }

    .income .financial-label i {
        color: #10b981;
    }

    .expense .financial-label i {
        color: #ef4444;
    }

    .financial-amount {
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 4px;
    }

    .financial-percentage {
        font-size: 12px;
        color: #64748b;
        font-weight: 500;
    }

    .financial-flow {
        margin: 20px 0;
    }

    .flow-bar {
        height: 6px;
        background: #e2e8f0;
        border-radius: 3px;
        overflow: hidden;
        display: flex;
    }

    .income-flow {
        height: 100%;
        background: #10b981;
    }

    .expense-flow {
        height: 100%;
        background: #ef4444;
    }

    .net-balance {
        padding: 20px;
        background: #f0f9ff;
        border-radius: 8px;
        border: 1px solid #e0f2fe;
        text-align: center;
    }

    .net-label {
        font-size: 12px;
        color: #0369a1;
        margin-bottom: 8px;
    }

    .net-amount {
        font-size: 28px;
        font-weight: 800;
        margin-bottom: 12px;
    }

    .net-amount.positive {
        color: #10b981;
    }

    .net-amount.negative {
        color: #ef4444;
    }

    .savings-info {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: white;
        border-radius: 20px;
        font-size: 12px;
        color: #0369a1;
        border: 1px solid #e0f2fe;
    }

    /* Risk Card */
    .risk-card .card-body {
        padding: 20px;
    }

    .risk-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 20px;
    }

    .risk-item {
        padding: 16px;
        text-align: center;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .high-risk {
        background: #fef2f2;
        border-color: #fecaca;
    }

    .medium-risk {
        background: #fffbeb;
        border-color: #fde68a;
    }

    .transactions {
        background: #f0f9ff;
        border-color: #e0f2fe;
    }

    .risk-count {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 4px;
    }

    .high-risk .risk-count {
        color: #dc2626;
    }

    .medium-risk .risk-count {
        color: #d97706;
    }

    .transactions .risk-count {
        color: #0369a1;
    }

    .risk-label {
        font-size: 11px;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .risk-distribution {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .distribution-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .distribution-item:last-child {
        margin-bottom: 0;
    }

    .distribution-label {
        font-size: 13px;
        color: #64748b;
    }

    .distribution-value {
        font-size: 14px;
        font-weight: 600;
        color: #1e293b;
    }

    .risk-tag {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .risk-tag.high {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }

    .risk-tag.medium {
        background: #fef3c7;
        color: #d97706;
        border: 1px solid #fde68a;
    }

    .risk-tag.low {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
    }

    /* Analysis Tabs */
    .detailed-analysis {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        margin-bottom: 30px;
        overflow: hidden;
    }

    .analysis-tabs {
        border-bottom: 1px solid #e2e8f0;
        padding: 0 24px;
    }

    .nav-tabs {
        border-bottom: none;
        gap: 8px;
    }

    .nav-link {
        padding: 16px 20px;
        border: none;
        background: none;
        color: #64748b;
        font-size: 14px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 8px 8px 0 0;
        transition: all 0.2s;
    }

    .nav-link:hover {
        color: #3b82f6;
        background: #f8fafc;
    }

    .nav-link.active {
        color: #3b82f6;
        background: white;
        border-bottom: 2px solid #3b82f6;
    }

    /* Tab Content */
    .tab-content {
        padding: 0;
    }

    .tab-pane {
        padding: 0;
    }

    .panel-header {
        padding: 24px 24px 16px;
        border-bottom: 1px solid #e2e8f0;
    }

    .panel-header h3 {
        margin: 0 0 8px 0;
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
    }

    .panel-header p {
        margin: 0;
        font-size: 14px;
        color: #64748b;
    }

    .panel-content {
        padding: 24px;
    }

    /* Transaction Channels */
    .channel-analysis {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
    }

    .channel-card {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        transition: all 0.2s;
    }

    .channel-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .channel-card[data-risk="High"] {
        border-left: 4px solid #ef4444;
    }

    .channel-card[data-risk="Medium"] {
        border-left: 4px solid #f59e0b;
    }

    .channel-card[data-risk="Low"] {
        border-left: 4px solid #10b981;
    }

    .channel-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .channel-title {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .channel-icon {
        width: 32px;
        height: 32px;
        background: #e0f2fe;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0369a1;
    }

    .channel-title span {
        font-weight: 600;
        color: #1e293b;
    }

    .risk-indicator {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .risk-indicator.high {
        background: #fee2e2;
        color: #dc2626;
    }

    .risk-indicator.medium {
        background: #fef3c7;
        color: #d97706;
    }

    .risk-indicator.low {
        background: #dcfce7;
        color: #166534;
    }

    .channel-stats {
        margin-bottom: 12px;
    }

    .stat-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .stat-row:last-child {
        margin-bottom: 0;
    }

    .stat-label {
        color: #64748b;
    }

    .stat-value {
        font-weight: 600;
        color: #1e293b;
    }

    .stat-value.amount {
        color: #3b82f6;
    }

    .channel-progress .progress {
        height: 4px;
        background: #e2e8f0;
        border-radius: 2px;
        overflow: hidden;
    }

    .channel-progress .progress-bar {
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        border-radius: 2px;
    }

    /* Monthly Analysis Table */
    .monthly-table-container {
        overflow-x: auto;
    }

    .monthly-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .monthly-table th {
        padding: 12px 16px;
        background: #f8fafc;
        border-bottom: 2px solid #e2e8f0;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-align: left;
    }

    .monthly-table td {
        padding: 16px;
        border-bottom: 1px solid #e2e8f0;
        font-size: 14px;
        color: #1e293b;
    }

    .monthly-table tr:last-child td {
        border-bottom: none;
    }

    .monthly-table tr:hover {
        background: #f8fafc;
    }

    .amount {
        font-weight: 600;
    }

    .amount.income {
        color: #10b981;
    }

    .amount.expense {
        color: #ef4444;
    }

    .risk-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .risk-badge.high {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }

    .risk-badge.medium {
        background: #fef3c7;
        color: #d97706;
        border: 1px solid #fde68a;
    }

    .risk-badge.low {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
    }

    .risk-flags {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
    }

    .flag-badge {
        padding: 2px 6px;
        background: #e0f2fe;
        color: #0369a1;
        border-radius: 4px;
        font-size: 11px;
        border: 1px solid #bae6fd;
    }

    /* High Value Transactions Table */
    .highvalue-table-container {
        overflow-x: auto;
    }

    .highvalue-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .highvalue-table th {
        padding: 12px 16px;
        background: #f8fafc;
        border-bottom: 2px solid #e2e8f0;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-align: left;
    }

    .highvalue-table td {
        padding: 16px;
        border-bottom: 1px solid #e2e8f0;
        font-size: 14px;
        color: #1e293b;
    }

    .highvalue-table tr:last-child td {
        border-bottom: none;
    }

    .highvalue-table tr:hover {
        background: #f8fafc;
    }

    .transaction-date {
        font-weight: 600;
        color: #1e293b;
    }

    .transaction-description {
        color: #64748b;
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .category-tag {
        padding: 4px 8px;
        background: #e0f2fe;
        color: #0369a1;
        border-radius: 4px;
        font-size: 12px;
        border: 1px solid #bae6fd;
    }

    .transaction-amount {
        font-weight: 700;
        font-size: 15px;
    }

    .transaction-amount.credit {
        color: #10b981;
    }

    .transaction-amount.debit {
        color: #ef4444;
    }

    .type-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .credit-badge {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
    }

    .debit-badge {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }

    .action-tag {
        padding: 4px 10px;
        background: #f0f9ff;
        color: #0369a1;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        border: 1px solid #e0f2fe;
    }

    /* Counterparty Analysis */
    .counterparty-table-container {
        overflow-x: auto;
        margin-bottom: 24px;
    }

    .counterparty-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

    .counterparty-table th {
        padding: 12px 16px;
        background: #f8fafc;
        border-bottom: 2px solid #e2e8f0;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        text-align: left;
    }

    .counterparty-table td {
        padding: 16px;
        border-bottom: 1px solid #e2e8f0;
        font-size: 14px;
        color: #1e293b;
    }

    .counterparty-table tr:last-child td {
        border-bottom: none;
    }

    .counterparty-table tr:hover {
        background: #f8fafc;
    }

    .counterparty-info {
        min-width: 150px;
    }

    .counterparty-name {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 4px;
    }

    .counterparty-meta {
        font-size: 12px;
        color: #64748b;
    }

    .transaction-count {
        display: inline-block;
        padding: 2px 8px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .concentration {
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
    }

    .concentration.credit {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
    }

    .concentration.debit {
        background: #fee2e2;
        color: #dc2626;
        border: 1px solid #fecaca;
    }

    .concentration.none {
        color: #94a3b8;
    }

    .total-amount {
        font-weight: 700;
        color: #3b82f6;
    }

    .concentration-summary {
        margin-top: 24px;
        padding: 20px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .concentration-summary h4 {
        margin: 0 0 16px 0;
        font-size: 16px;
        font-weight: 600;
        color: #1e293b;
    }

    .concentration-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .concentration-card {
        padding: 16px;
        background: white;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .concentration-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .concentration-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }

    .concentration-metrics .metric {
        text-align: center;
    }

    .concentration-metrics .label {
        display: block;
        font-size: 11px;
        color: #64748b;
        margin-bottom: 4px;
    }

    .concentration-metrics .value {
        display: block;
        font-size: 13px;
        font-weight: 600;
        color: #1e293b;
    }

    .concentration-metrics .value.credit {
        color: #10b981;
    }

    .concentration-metrics .value.debit {
        color: #ef4444;
    }

    /* Empty States */
    .empty-panel {
        padding: 60px 40px;
        text-align: center;
    }

    .empty-content i {
        font-size: 48px;
        color: #cbd5e1;
        margin-bottom: 16px;
    }

    .empty-content h4 {
        margin: 0 0 8px 0;
        font-size: 18px;
        color: #64748b;
        font-weight: 600;
    }

    .empty-content p {
        margin: 0;
        color: #94a3b8;
        max-width: 400px;
        margin: 0 auto;
    }

    /* Report Footer */
    .report-footer {
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }

    .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .report-info {
        display: flex;
        gap: 24px;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #64748b;
    }

    .footer-actions {
        display: flex;
        gap: 8px;
    }

    .btn-secondary {
        padding: 8px 16px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        color: #64748b;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .btn-secondary:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }

    /* No Data Section */
    .no-data-section {
        padding: 60px 20px;
        text-align: center;
    }

    .empty-state-card {
        max-width: 400px;
        margin: 0 auto;
        padding: 40px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
    }

    .empty-icon {
        width: 80px;
        height: 80px;
        background: #e0f2fe;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 32px;
        color: #0369a1;
    }

    .empty-state-card h3 {
        margin: 0 0 12px 0;
        font-size: 20px;
        font-weight: 600;
        color: #1e293b;
    }

    .empty-state-card p {
        margin: 0 0 24px 0;
        color: #64748b;
    }

    .btn-primary {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s;
        text-decoration: none;
    }

    .btn-primary:hover {
        background: #2563eb;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .header-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }
        
        .header-right {
            width: 100%;
            justify-content: space-between;
        }
    }

    @media (max-width: 768px) {
        .audit-header {
            padding: 12px 0;
        }

        .header-breadcrumb {
            margin-bottom: 8px;
            font-size: 12px;
        }

        .header-left h1 {
            font-size: 20px;
        }

        .account-info {
            font-size: 12px;
        }

        .header-content {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }

        .header-right {
            flex-direction: column;
            width: 100%;
            gap: 10px;
        }

        .action-buttons {
            width: 100%;
        }

        .btn-audit-action {
            flex: 1;
            justify-content: center;
        }

        .btn-switch-account {
            width: 100%;
            justify-content: center;
        }

        .btn-switch-account span {
            display: none;
        }

        .btn-switch-account i:last-child {
            display: none;
        }

        .summary-cards-grid {
            grid-template-columns: 1fr;
        }

        .analysis-tabs {
            padding: 0 15px;
        }

        .nav-tabs {
            flex-wrap: nowrap;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .nav-link {
            white-space: nowrap;
        }

        .panel-header,
        .panel-content {
            padding: 20px;
        }

        .channel-analysis {
            grid-template-columns: 1fr;
        }

        .footer-content {
            flex-direction: column;
            gap: 20px;
            text-align: center;
        }

        .report-info {
            flex-direction: column;
            gap: 12px;
        }

        .footer-actions {
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .audit-container {
            padding: 15px;
        }

        .audit-header {
            padding: 10px 15px;
        }

        .header-breadcrumb {
            display: none;
        }

        .header-left h1 {
            font-size: 18px;
        }

        .panel-header,
        .panel-content {
            padding: 15px;
        }

        .card-header,
        .card-body,
        .card-footer {
            padding: 15px;
        }

        .metrics-grid {
            grid-template-columns: 1fr;
        }

        .risk-metrics {
            grid-template-columns: 1fr;
        }

        .concentration-cards {
            grid-template-columns: 1fr;
        }

        .action-buttons {
            gap: 4px;
        }

        .btn-audit-action span {
            display: none;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Bootstrap tabs
        const tabTriggerList = [].slice.call(document.querySelectorAll('#auditTabs button[data-bs-toggle="tab"]'));
        tabTriggerList.forEach(function (tabTriggerEl) {
            tabTriggerEl.addEventListener('click', function (event) {
                event.preventDefault();
                const target = document.querySelector(this.getAttribute('data-bs-target'));
                // Remove active class from all tabs
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('show', 'active'));
                // Add active class to clicked tab and corresponding pane
                this.classList.add('active');
                target.classList.add('show', 'active');
            });
        });

        // Animate metric counters
        function animateCounters() {
            const counters = document.querySelectorAll('.metric-value, .risk-count');
            counters.forEach(counter => {
                const target = parseFloat(counter.textContent.replace(/,/g, ''));
                if (!isNaN(target) && target > 0) {
                    const duration = 1000;
                    const step = target / (duration / 16);
                    let current = 0;
                    
                    const timer = setInterval(() => {
                        current += step;
                        if (current >= target) {
                            counter.textContent = Math.round(target).toLocaleString();
                            clearInterval(timer);
                        } else {
                            counter.textContent = Math.round(current).toLocaleString();
                        }
                    }, 16);
                }
            });
        }

        // Observe when summary cards come into view
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    animateCounters();
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.1 });

        const summaryCards = document.querySelector('.audit-summary-section');
        if (summaryCards) {
            observer.observe(summaryCards);
        }

        // Table row hover effects
        const tableRows = document.querySelectorAll('tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.backgroundColor = '#f8fafc';
            });
            
            row.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '';
            });
        });

        // Export button functionality
        const exportBtn = document.querySelector('.export-btn');
        if (exportBtn) {
            exportBtn.addEventListener('click', function() {
                // Show export modal or generate PDF
                alert('Export functionality would generate a PDF report here.');
            });
        }

        // Print button functionality
        const printBtn = document.querySelector('.print-btn');
        if (printBtn) {
            printBtn.addEventListener('click', function() {
                window.print();
            });
        }

        // Highlight active tab based on scroll
        function highlightActiveTab() {
            const tabPanes = document.querySelectorAll('.tab-pane');
            const tabs = document.querySelectorAll('.nav-link');
            let currentTab = '';
            
            tabPanes.forEach(pane => {
                const rect = pane.getBoundingClientRect();
                if (rect.top <= 100 && rect.bottom >= 100) {
                    currentTab = pane.id;
                }
            });
            
            if (currentTab) {
                tabs.forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.getAttribute('data-bs-target') === `#${currentTab}`) {
                        tab.classList.add('active');
                    }
                });
            }
        }

        window.addEventListener('scroll', highlightActiveTab);
        highlightActiveTab(); // Initial call

        // Enhance table scrolling on mobile
        const tables = document.querySelectorAll('.monthly-table-container, .highvalue-table-container, .counterparty-table-container');
        tables.forEach(table => {
            table.addEventListener('touchstart', function() {
                this.style.overflowX = 'auto';
            });
        });

        // Risk level color coding
        function applyRiskColors() {
            const riskElements = document.querySelectorAll('[class*="risk-"]');
            riskElements.forEach(el => {
                if (el.classList.contains('risk-high')) {
                    el.style.backgroundColor = '#fef2f2';
                } else if (el.classList.contains('risk-medium')) {
                    el.style.backgroundColor = '#fffbeb';
                } else if (el.classList.contains('risk-low')) {
                    el.style.backgroundColor = '#dcfce7';
                }
            });
        }

        applyRiskColors();
    });
</script>
{% endblock %}
